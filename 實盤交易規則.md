目的： 建立一個穩定、安全且自動化的交易執行系統，確保策略依據既定規則執行，並嚴格控管資金風險。
角色： 量化交易者 (Quantitative Trader)
背景假設 (Background):
我已經擁有一個或多個經過回測驗證的交易策略。
每個策略在發送訂單時，都會附帶唯一的策略識別碼 (Strategy ID)。
系統擁有訪問交易所 API 的權限，且資金已到位。
系統具備本地資料庫（或文件存儲），用於記錄當日初始權益、訂單狀態與持倉資訊（以防程式重啟後數據遺失）。

情境: 系統啟動與自我檢查 (System Initialization & Pre-flight Check)
    這是為了防止系統在「不健康」的狀態下貿然開始交易。

    假設 我準備啟動交易系統
    當 我執行啟動指令
    那麼 系統應先讀取本地數據庫，載入當日初始權益與歷史持倉狀態
    並且 系統應驗證交易所 API 連線是否正常
    並且 檢查系統時間與交易所伺服器時間是否同步
    只有當 所有檢查通過，系統才進入「等待信號」狀態，並發送 Telegram 通知：「系統啟動成功，目前監控中」。

情境: 帳戶級風險管理與熔斷 (Account-Level Risk Management)
    這是最後一道防線，保護整體資金安全。

    假設 系統正在運行
    當 帳戶的「總權益」單日回撤超過設定的閾值（例如 5%）
    那麼 系統應該觸發帳戶級熔斷 (Account Circuit Breaker)
    並且 立即取消所有掛單，並市價平倉所有現有部位
    並且 停止所有策略的運行，拒絕任何新的開倉信號
    並且 通過 Telegram 發送紅色警報：「帳戶級熔斷觸發，系統已停止交易」。

情境: 策略級風險管理 (Strategy-Level Risk Management)
    針對單一表現不佳的策略進行隔離，不影響其他優質策略。

    假設 系統正在運行多個策略
    當 某個特定策略（依據 Strategy ID 追蹤）的單日淨值回撤超過設定的閾值（例如 3%）
    那麼 系統應該觸發該策略的策略級熔斷
    並且 僅針對該 Strategy ID 相關的部位進行市價平倉
    並且 停止該策略的新開倉信號，但不應影響其他策略的運行
    並且 通過 Telegram 發送黃色警報：「策略 [ID] 熔斷觸發，已停止該策略」。

情境: 連線異常與狀態同步 (Connection Loss & Reconciliation)
    處理網路不穩定導致的「幽靈倉位」問題。

    假設 系統正在運行
    當 偵測到與交易所 API 斷線超過 10 秒
    那麼 系統應進入「暫停模式」，暫停發送新訂單並嘗試重連
    當 重連成功後
    那麼 系統應立即執行部位核對 (Position Reconciliation)
    並且 若發現本地紀錄與交易所持倉不符，且差異超過容許閾值（避免微小誤差），應以交易所數據為準強制更新本地狀態
    並且 若發生強制更新，需記錄日誌並發送警報通知人工複查。

情境: 訂單執行監控 (Execution Monitoring)
    確保發出去的指令被正確執行，避免無效重試。

    假設 系統發出買入或賣出信號
    當 訂單發送後
    那麼 系統應監控訂單的回報狀態（Filled, Partially Filled, Canceled, Rejected）
    並且 若收到 "Rejected"（拒單）狀態（可能因餘額不足或參數錯誤）
    那麼 系統應記錄錯誤代碼，並停止該策略以避免陷入無限報錯的迴圈
    並且 發送 Telegram 錯誤通知。

情境: 系統存活監控 (System Heartbeat)
    防止系統「假死」導致無人知曉。

    假設 系統正在運行
    當 系統運行每滿一小時（或設定的時間間隔）
    那麼 系統應通過 Telegram 發送一條「心跳 (Heartbeat)」訊息
    並且 訊息內容應包含：當前時間、總權益、各策略持倉狀態、以及系統是否正常運作的標記。

情境: 紀錄與報告 (Logging & Reporting)
    數據分析與每日結算。

    假設 系統正在運行
    當 發生任何交易、錯誤、警報或狀態變更時
    那麼 系統應將詳細資訊（時間戳、事件類型、原始數據）寫入日誌檔案 (Log File)
    當 時間到達 UTC+8 00:00（或自定義結算時間）
    那麼 系統應執行每日結算，生成當日績效報告
    並且 重置單日虧損計數器（Reset Daily Drawdown Counter）
    並且 將當日的最終權益寫入資料庫，作為明日的「初始權益」參考基準。